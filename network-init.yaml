---
settings:
  chains:
    relay_chain:
      wsPort: 9900
    asset_reserve_parachain: &arp
      paraId: &arp_id 1000
      wsPort: 9910
    evm_parachain: &evmp
      paraId: 2000
      wsPort: 9920
    oracle_consumer_parachain: &ocp
      paraId: &ocp_id 3000
      wsPort: 9930

  variables:
    chains:
      asset_reserve_parachain:
        signer: &arp_signer //Alice
      evm_parachain:
        signer: &evmp_signer "0x5fb92d6e98884f76de468fa3f6278f8807c48bebc13595d45af5bdc4da702133"
        derivative_accounts:
          tellor_ocp: &evmp_tocpda "0x2aa1e5ffc61d158af854fa28b31fb87722e83b64"
      oracle_consumer_parachain:
        signer: &ocp_signer //Alice
        tellor_pallet_account: &ocp_tellor_account 5EYCAe5ijiYfyFR5Zp1cdckhKCKaUyo9KQsTcU1NR9u2mwTk
    tokens:
      # Tellor Tribute token
      trb:
        id: &TRB_id 872
        symbol: &TRB TRB
        name: &TRB_name Tellor Tribute
        owner: &TRB_owner HNZata7iMYWmk5RvZRTiAsSDhV8366zq2YGb3tLH5Upf74F # Alice's account on asset reserve parachain
        min_balance: &TRB_min_balance 1000000000
        decimals: &TRB_decimals 12
      # Derivative of Tellor Tribute token
      xcTRB:
        symbol: &xcTRB xcTRB
        name: &xcTRB_name Tellor Tribute
        min_balance: &xcTRB_min_balance 1000000000
        decimals: &xcTRB_decimals 12
      # Derivative of native Oracle Consumer parachain token
      xcOCP:
        symbol: &xcOCP xcOCP
        name: &xcOCP_name Oracle Consumer Parachain
        min_balance: &xcOCP_min_balance 1000000000
        decimals: &xcOCP_decimals 12

tests:
  - name: Initialize Chains
    its:
      - name: Initialise asset reserve parachain
        actions:
          - extrinsics:
              # Create TRB token and set metadata
              - chain: *arp
                signer: *arp_signer
                pallet: assets
                call: create
                args: [
                  *TRB_id, # id
                  { id: *TRB_owner }, # owner
                  *TRB_min_balance # min balance
                ]
              - chain: *arp
                signer: *arp_signer
                pallet: assets
                call: setMetadata
                args: [
                  *TRB_id, # id
                  *TRB_name, # name
                  *TRB, # symbol
                  *TRB_decimals # decimals
                ]
      - name: Initialise EVM parachain
        actions:
          - extrinsics:
              # Register TRB as foreign asset
              - chain: *evmp
                sudo: true
                signer: *evmp_signer
                keyPairType: ethereum
                pallet: assetManager
                call: registerForeignAsset
                args: [
                  # asset
                  { xcm: { parents: 1, interior: { x3: { Parachain: *arp_id, PalletInstance: 50, GeneralIndex: *TRB_id } } } },
                  # metadata
                  {
                    name: *xcTRB_name,
                    symbol: *xcTRB,
                    decimals: *xcTRB_decimals,
                    isFrozen: false
                  },
                  *xcTRB_min_balance, # minAmount
                  false, # isSufficient
                ]
              # Register native token of OCP as foreign asset
              - chain: *evmp
                sudo: true
                signer: *evmp_signer
                keyPairType: ethereum
                pallet: assetManager
                call: registerForeignAsset
                args: [
                  # asset
                  { xcm: {  parents: 1, interior: { x1: { Parachain: *ocp_id } } } },
                  # metadata
                  {
                    name: *xcOCP_name,
                    symbol: *xcOCP,
                    decimals: *xcOCP_decimals,
                    isFrozen: false
                  },
                  *xcOCP_min_balance, # minAmount
                  false, # isSufficient
                ]
              # Fund multi-location derivative account of TellorPallet@OracleConsumerParachain
              - chain: *evmp
                signer: *evmp_signer
                keyPairType: ethereum
                pallet: balances
                call: transfer
                args: [
                  *evmp_tocpda,
                  "1000000000000000000"
                ]
      - name: Initialise Oracle Consumer parachain
        actions:
          - extrinsics:
              # Fund Tellor pallet for remote xcm fees
              - chain: *ocp
                signer: *ocp_signer
                pallet: balances
                call: transfer
                args: [
                  *ocp_tellor_account,
                  "100000000000000000"
                ]
              # Register parachain with controller contracts
              - chain: *ocp
                sudo: true
                signer: *ocp_signer
                pallet: tellor
                call: register
                args: [
                  "100000000000000000000", # stake amount
                  5000000000, # require weight at most
                  100000 # gas limit
                ]
